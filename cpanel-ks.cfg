# Kickstart file automatically generated by anaconda.
install
cdrom
autostep
text
authconfig --enableshadow --enablemd5
selinux --disabled
firstboot --disabled
network --bootproto=query
firewall --disabled

partition /tmp --size=2048
partition swap --recommended --maxsize=3072
partition / --size=1 --grow

# Double ram or 3gB, which ever is smaller
# tmp - 2gB
# monolithic root
# update rpms 
%packages
acl
acpid
alsa-lib
amtu
anacron
aspell
aspell-en
at
atk
attr
audit
audit-libs
audit-libs-python
authconfig
autoconf
autofs
automake
avahi
avahi-compat-libdns_sd
basesystem
bash
bc
bind
bind-devel
bind-libs
bind-utils
binutils
bison
bitstream-vera-fonts
bzip2
bzip2-libs
caching-nameserver
cairo
ccid
centos-release
centos-release-notes
checkpolicy
chkconfig
chkfontpath
compat-db
conman
coolkey
coreutils
cpio
cpp
cpuspeed
cracklib
cracklib-dicts
crash
crontabs
cryptsetup-luks
cups
cups-libs
curl
cvs
cyrus-sasl
cyrus-sasl-lib
cyrus-sasl-plain
db4
db4-devel
dbus
dbus-glib
dbus-libs
dbus-python
desktop-file-utils
device-mapper
device-mapper-event
device-mapper-multipath
dhclient
dhcpv6-client
diffutils
dmidecode
dmraid
dmraid-events
dnsmasq
dos2unix
dosfstools
dump
e2fsprogs
e2fsprogs-devel
e2fsprogs-libs
ecryptfs-utils
ed
eject
elfutils
elfutils-libelf
elfutils-libs
ethtool
expat
expat-devel
expect
fbset
file
filesystem
findutils
finger
fipscheck
fipscheck-lib
firstboot-tui
flex
fontconfig
fontconfig-devel
freetype
freetype-devel

ftp
gamin
gamin-devel
gamin-python
gawk
gcc
gcc-c++
GConf2
gd
gdbm
gdbm-devel
gd-devel
gd-progs
gettext
gettext-devel
glib2
glibc
glibc-common
glibc-devel
glibc-headers
gnupg
gnutls
gpm
grep
groff
grub
gtk2
gzip
hal
hdparm
hesiod
hicolor-icon-theme
hmaccalc
htmlview
hwdata
ifd-egate
imake
info
initscripts
iproute
ipsec-tools
iptables
iptables-ipv6
iptstate
iputils
irda-utils
irqbalance
jwhois
kbd
kernel
kernel-headers
keyutils
keyutils-libs
keyutils-libs-devel
kpartx
krb5-devel
krb5-libs
krb5-workstation
ksh
kudzu
less
lftp
libacl
libaio
libart_lgpl
libattr
libcap
libdaemon
libdrm
libevent
libfontenc
libFS
libgcc
libgcj
libgcrypt
libgomp
libgpg-error
libgssapi
libhugetlbfs
libICE
libIDL
libidn
libjpeg
libjpeg-devel
libnotify
libpcap
libpng
libpng-devel
libselinux
libselinux-devel
libselinux-python
libselinux-utils
libsemanage
libsepol
libsepol-devel
libSM
libstdc++
libstdc++-devel
libsysfs
libtermcap
libtiff
libtiff-devel
libtool
libtool-ltdl
libtool-ltdl-devel
libusb
libuser
libutempter
libvolume_id
libwnck
libX11
libX11-devel
libXau
libXau-devel
libXcursor
libXdmcp
libXdmcp-devel
libXext
libXfixes
libXfont
libXft
libXi
libXinerama
libxml2
libxml2-devel
libxml2-python
libXpm
libXpm-devel
libXrandr
libXrender
libXres
libXt
libXtst
libXxf86vm
logrotate
logwatch
lsof
lvm2
lynx
m2crypto
m4
mailcap
mailx
make
MAKEDEV
man
man-pages
mcstrans
mdadm
mesa-libGL
mesa-libGL-devel
mgetty
microcode_ctl
mingetty
mkbootdisk
mkinitrd
mktemp
mlocate
module-init-tools
mtools
mtr
nano
nash
nc
ncurses
ncurses-devel
net-tools
NetworkManager
NetworkManager-glib
newt
nfs-utils
nfs-utils-lib
notification-daemon
nscd
nspr
nss
nss_db
nss_ldap
nss-tools
ntsysv
numactl
oddjob
oddjob-libs
openldap
openssh
openssh-clients
openssh-server
openssl
openssl-devel
ORBit2
pam
pam_ccreds
pam-devel
pam_krb5
pam_passwdqc
pam_pkcs11
pam_smb
pango
paps
parted
passwd
patch
pax
pciutils
pcmciautils
pcre
pcsc-lite
pcsc-lite-libs
perl
perl-String-CRC32
pinfo
pkgconfig
pkinit-nss
pm-utils
policycoreutils
popt
portmap
ppp
prelink
procmail
procps
psacct
psmisc
pygobject2
python
python-devel
python-docs
python-elementtree
python-iniparse
python-sqlite
python-tools
python-urlgrabber
quota
rcs
rdate
rdist
readahead
readline
redhat-logos
redhat-lsb
redhat-menus
rhpl
rmt
rng-utils
rootfiles
rpm
rpm-build
rpm-libs
rpm-python
rp-pppoe
rsh
rsync
sed
selinux-policy
selinux-policy-targeted
setarch
setools
setserial
setup
setuptool
sgpio
shadow-utils
sharutils
slang
smartmontools
sos
specspo
sqlite
startup-notification
strace
stunnel
sudo
symlinks
sysfsutils
sysklogd
syslinux
sysstat
system-config-network-tui
system-config-securitylevel-tui
SysVinit
talk
tar
tcl
tclx
tcpdump
tcp_wrappers
tcsh
telnet
termcap
time
tix
tk
tkinter
tmpwatch
traceroute
tree
trousers
ttmkfdir
tzdata
udev
udftools
unix2dos
unzip
urw-fonts
usbutils
usermode
util-linux
vconfig
vim-minimal
vixie-cron
wget
which
wireless-tools
words
wpa_supplicant
xorg-x11-filesystem
xorg-x11-font-utils
xorg-x11-proto-devel
xorg-x11-xfs
ypbind
yp-tools
yum
yum-fastestmirror
yum-metadata-parser
yum-updatesd
zip
zlib
zlib-devel
%post

mkdir /home/cpinst

cat <<EOM >> /home/cpinst/CDinstaller.sh
#!/bin/bash
function messenger {
	echo \$1 >> /dev/console
	wall \$1
	echo \$1 >> /var/log/cpanel-install-autoinstaller.log
}

if ! nc -z httpupdate.cpanel.net 80 -w 10 > /dev/null; then
	messenger "Could not reach httpupdate.cpanel.net, aborting installation.  Please resolve this issue and reboot to proceed with installation."
	exit
fi
touch /var/log/cpanel-install-thread0.log
touch /var/log/cpanel-install-thread1.log
messenger "Starting CentOS system update"
yum update -y
messenger "Finished CentOS system update, starting cPanel installation"
cd /home/cpinst

##PRE INSTALLATION SECTION
messenger "Setting cPanel branch to release"
echo "CPANEL=release" > /etc/cpupdate.conf
messenger "Downloading cPanel Profile"
mkdir -p /root/cpanel_profile/
wget -O /root/cpanel_profile/cpanel.config http://github.com/cpanel.config
messenger "Downloading EA3 Profile"
wget -O /etc/cp_easyapache_OMR_profile.yaml http://github.com/easyapache.yaml
messenger "Downloading Getting Started Wizard settings"
touch /etc/.whostmgrft
wget -O /etc/wwwacct.conf http://github.com/wwwacct.conf
/scripts/initquotas
##End pre-install

wget http://layer1.cpanel.net/latest
mkdir -p /usr/local/cpanel/logs
CPANEL_LOGGER_FILE=/usr/local/cpanel/logs/cpanel-install-autoinstaller.log
sh latest
if [ -d "/var/cpanel" ]; then
	mv /etc/motd.orig /etc/motd
	messenger "cPanel installation Complete"
fi

##POST INSTALLATION SECTION
messenger "Installing ConfigServer Firewall"
wget http://www.configserver.com/free/csf.tgz
tar vzxf csf.tgz
cd csf
./install.cpanel.sh
messenger "Installing Nxginx Admin Latest"
cd /usr/local/src
wget http://nginxcp.com/latest/nginxadmin.tar
tar xf nginxadmin.tar
cd publicnginx
./nginxinstaller install
messenger "Install ConfigServer Mail Manage"
http://www.configserver.com/free/cmm.tgz
tar -xzf cmm.tgz
cd cmm/
sh install.sh
messenger "Install ConfigServer Mail Queue"
http://www.configserver.com/free/cmq.tgz
tar -xzf cmq.tgz
cd cmq/
sh install.sh
messenger "Install ConfigServer ModSecurity Control"
http://www.configserver.com/free/cmc.tgz
tar -xzf cmc.tgz
cd cmc/
sh install.sh
##Todo: download modsecurity rules https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project

EOM

chmod +x /home/cpinst/CDinstaller.sh

cat <<EOM >> /etc/rc.local
	if [ ! -d "/var/cpanel"  ]; then
		nohup /home/cpinst/CDinstaller.sh & > /dev/null
	fi
EOM

mv /etc/motd /etc/motd.orig

cat <<EOM >> /etc/motd
The cPanel installation is currently taking place.
Please be patient and do not reboot the server.

To monitor the installation process please run:
tail -f /var/log/cpanel-install*
EOM

cat <<'EOF_DISABLE_SERVICES' > /root/cpanel-disable-services
#!/bin/bash
for service in \
   avahi-daemon \
   avahi-dnsconfd \
   bluetooth \
   capi \
   conman \
   cpus \
   irda \
   lisa \
   netplugd \
   ifplugd \
   NetworkManager \
   NetworkManagerDispatcher \
   netfs \
   netplugd \
   nfs \
   nfslock \
   nfsd \
   ncsd \
   oddjobd \
   openvpn \
   pcmcia \
   pcscd \
   portsentry \
   postfix \
   rawdevices \
   rdisc \
   rpcgssd \
   rpcidmapd \
   saslauthd \
   tcsd \
   vsftpd \
   winbind \
   wpa_supplicant \
   xfs \
   ypbind ;

   do

       echo "Disabling service: ${service}"
       chkconfig ${service} off &>/dev/null
       service ${service} stop &>/dev/null
done
EOF_DISABLE_SERVICES

chmod 100 /root/cpanel-disable-services
sh /root/cpanel-disable-services &>/dev/null
rm -f /root/cpanel-disable-services &>/dev/null

echo "/bin/false" >> /etc/shells
